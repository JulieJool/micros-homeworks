# Домашнее задание к занятию «Микросервисы: подходы»

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.


## Задача 1: Обеспечить разработку

Предложите решение для обеспечения процесса разработки: хранение исходного кода, непрерывная интеграция и непрерывная поставка. 
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- облачная система;
- система контроля версий Git;
- репозиторий на каждый сервис;
- запуск сборки по событию из системы контроля версий;
- запуск сборки по кнопке с указанием параметров;
- возможность привязать настройки к каждой сборке;
- возможность создания шаблонов для различных конфигураций сборок;
- возможность безопасного хранения секретных данных (пароли, ключи доступа);
- несколько конфигураций для сборки из одного репозитория;
- кастомные шаги при сборке;
- собственные докер-образы для сборки проектов;
- возможность развернуть агентов сборки на собственных серверах;
- возможность параллельного запуска нескольких сборок;
- возможность параллельного запуска тестов.

Обоснуйте свой выбор.

---     
Хорошим вариантом было бы использование **GitHub Actions (или GitLab CI/CD) с Docker и HashiCorp Vault.**         
Почему?
1. Все предложенные инструменты являются облачными, что обеспечивает доступность и масштабируемость.          
2. GitHub и GitLab предлагают встроенные CI/CD функции, что упрощает настройку и управление процессами.           
3. Docker и HashiCorp Vault обеспечивают возможность кастомизации и безопасного управления секретами.          
4. Поддержка параллельных сборок и тестов позволяет оптимизировать время разработки.          

Принципы взаимодействия тут следующие:          
Хранение кода: Исходный код хранится в репозиториях **GitHub или GitLab**, что позволяет разработчикам работать совместно и управлять версиями.             
Сборка и тестирование: **GitHub Actions или GitLab CI/CD** отслеживают изменения в репозитории и автоматически запускают сборки и тесты по событиям (например, push или pull request). Также можно запускать сборки вручную с указанием параметров.           
Управление секретами: **HashiCorp Vault** используется для безопасного хранения секретов, которые могут быть переданы в CI/CD процессы при необходимости.        
Контейнеризация: **Docker** используется для создания и развертывания приложений в контейнерах, что обеспечивает консистентность среды выполнения.           
Параллельные сборки: **GitHub Actions или GitLab CI/CD** позволяют запускать несколько сборок и тестов параллельно, что ускоряет процесс разработки.             

Возможности GitHub Actions (или GitLab CI/CD):     
- Запуск сборки по событию из системы контроля версий (например, push, pull request).       
- Запуск сборки по кнопке с указанием параметров через интерфейс.          
- Привязка настроек к каждой сборке через переменные окружения и секреты.         
- Поддержка кастомных шагов при сборке, что позволяет добавлять специфические команды и скрипты.        
- Создание собственных Docker-образов для сборки проектов.        
- Поддержка параллельного запуска нескольких сборок и тестов.

Возможности Docker:          
- Создание собственных Docker-образов для изоляции среды сборки.       
- Хранение образов в Docker Hub или в частных реестрах (например, GitHub Container Registry).

Возможности HashiCorp Vault:     
- Интеграция с CI/CD системами для безопасного доступа к секретам во время сборки и развертывания.
- Поддержка различных методов аутентификации и шифрования.

Что касается выбора между GitHub или GitLab:       
Плюсы GitHub:          
- Сообщество и экосистема: GitHub имеет более обширное сообщество, что означает больше доступных ресурсов, библиотек и интеграций.       
- Простота использования: Многие пользователи находят интерфейс GitHub более интуитивно понятным и удобным.             
- Marketplace: GitHub Actions предоставляет мощный и гибкий механизм для автоматизации процессов CI/CD, позволяя пользователям создавать сложные рабочие процессы с помощью простого синтаксиса YAML. Хотя GitLab также предлагает CI/CD, GitHub Actions интегрируется более глубоко в экосистему GitHub и имеет обширный Marketplace с готовыми действиями. Он предлагает множество сторонних приложений и интеграций, которые можно легко добавить к проектам. Хотя GitLab также имеет свои интеграции, Marketplace GitHub более развит и разнообразен.            
- Открытые проекты: GitHub стал домом для множества известных проектов с открытым исходным кодом и имеет более крупное сообщество разработчиков. Это создает более широкие возможности для сотрудничества и обмена знаниями.         

Плюсы GitLab:     
- Все в одном: GitLab предлагает интегрированные функции для управления проектами, CI/CD, мониторинга и безопасного управления кодом в одном инструменте. Это может быть удобным для команд, которые предпочитают единую платформу.           
- Более мощный CI/CD: GitLab CI/CD считается более гибким и мощным, позволяя более детальную настройку пайплайнов и использование различных методов развертывания.         
- Бесплатные функции: GitLab предлагает больше функционала в бесплатной версии, включая неограниченные приватные репозитории и более гибкие возможности для CI/CD.        
- Self-hosting: GitLab предлагает более удобные решения для самохостинга, что может быть критически важным для некоторых организаций.  
        
Если команда уже использует GitLab или если нужны его специфические функции, такие как более мощный CI/CD или всеобъемлющая платформа для управления проектами, GitLab может быть отличным выбором.         

---

## Задача 2: Логи

Предложите решение для обеспечения сбора и анализа логов сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор логов в центральное хранилище со всех хостов, обслуживающих систему;
- минимальные требования к приложениям, сбор логов из stdout;
- гарантированная доставка логов до центрального хранилища;
- обеспечение поиска и фильтрации по записям логов;
- обеспечение пользовательского интерфейса с возможностью предоставления доступа разработчикам для поиска по записям логов;
- возможность дать ссылку на сохранённый поиск по записям логов.

Обоснуйте свой выбор.

## Задача 3: Мониторинг

Предложите решение для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор метрик со всех хостов, обслуживающих систему;
- сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network;
- сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network;
- сбор метрик, специфичных для каждого сервиса;
- пользовательский интерфейс с возможностью делать запросы и агрегировать информацию;
- пользовательский интерфейс с возможностью настраивать различные панели для отслеживания состояния системы.

Обоснуйте свой выбор.

## Задача 4: Логи * (необязательная)

Продолжить работу по задаче API Gateway: сервисы, используемые в задаче, пишут логи в stdout. 

Добавить в систему сервисы для сбора логов Vector + ElasticSearch + Kibana со всех сервисов, обеспечивающих работу API.

### Результат выполнения: 

docker compose файл, запустив который можно перейти по адресу http://localhost:8081, по которому доступна Kibana.
Логин в Kibana должен быть admin, пароль qwerty123456.


## Задача 5: Мониторинг * (необязательная)

Продолжить работу по задаче API Gateway: сервисы, используемые в задаче, предоставляют набор метрик в формате prometheus:

- сервис security по адресу /metrics,
- сервис uploader по адресу /metrics,
- сервис storage (minio) по адресу /minio/v2/metrics/cluster.

Добавить в систему сервисы для сбора метрик (Prometheus и Grafana) со всех сервисов, обеспечивающих работу API.
Построить в Graphana dashboard, показывающий распределение запросов по сервисам.

### Результат выполнения: 

docker compose файл, запустив который можно перейти по адресу http://localhost:8081, по которому доступна Grafana с настроенным Dashboard.
Логин в Grafana должен быть admin, пароль qwerty123456.

---

### Как оформить ДЗ?

Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.

---
